<!-- comment_like.html -->
<a 
    hx-get="{% url 'comment_like' comment.comment_id %}"
    hx-target="#comment_like-{{comment.comment_id}}"
    hx-swap="innerHTML"
    hx-trigger="click throttle:200ms"
    href="#"
    class="comment-like-btn"
    style="text-decoration: none; color: #666;"
    aria-label="Like this comment">
    
    {% if request.user in comment.like.all %}
    <!-- Liked state with animation -->
    <span class="like-count like-count-animation" 
          id="count-{{comment.comment_id}}">
        {% if comment.like.count > 0 %} {{comment.like.count}} {% endif %}
    </span>
    <i class="fa-solid fa-heart action-icon heart-icon heart-pulse" 
       style="color: var(--color-danger, #ff3040);"></i>
    {% else %}
    <!-- Not liked state -->
    <span class="like-count" id="count-{{comment.comment_id}}">
        {% if comment.like.count > 0 %} {{comment.like.count}} {% endif %}
    </span>
    <i class="fa-regular fa-heart action-icon heart-icon"></i>
    {% endif %}
</a>

<style>
/* Animation styles */
.comment-like-btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    cursor: pointer;
    padding: 4px 8px;
    border-radius: 20px;
    transition: all 0.2s ease;
    user-select: none;
}

.comment-like-btn:hover {
    background-color: rgba(255, 48, 64, 0.08);
}

/* Heart icon animations */
.heart-icon {
    font-size: 16px;
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.heart-pulse {
    animation: heartPulse 0.4s ease-out;
}

@keyframes heartPulse {
    0% {
        transform: scale(1);
    }
    25% {
        transform: scale(1.3);
    }
    50% {
        transform: scale(0.9);
    }
    75% {
        transform: scale(1.1);
    }
    100% {
        transform: scale(1);
    }
}

/* Like count animation */
.like-count {
    font-size: 14px;
    font-weight: 500;
    min-width: 18px;
    text-align: center;
    transition: all 0.3s ease;
}

.like-count-animation {
    animation: countBounce 0.5s ease-out;
    color: var(--color-danger, #ff3040);
    font-weight: 600;
}

@keyframes countBounce {
    0% {
        transform: translateY(0);
    }
    30% {
        transform: translateY(-8px);
    }
    50% {
        transform: translateY(2px);
    }
    70% {
        transform: translateY(-4px);
    }
    90% {
        transform: translateY(1px);
    }
    100% {
        transform: translateY(0);
    }
}

/* Click effect */
.comment-like-btn:active .heart-icon {
    transform: scale(0.9);
}

/* Particles effect (optional, requires JavaScript) */
.heart-particle {
    position: absolute;
    width: 6px;
    height: 6px;
    background: var(--color-danger, #ff3040);
    border-radius: 50%;
    pointer-events: none;
    opacity: 0;
}

/* For smooth HTMX transitions */
.htmx-swapping .heart-icon {
    opacity: 0.5;
    transform: scale(0.8);
}

.htmx-settling .heart-icon {
    transition: all 0.3s ease;
}
</style>

<!-- Optional JavaScript for particle effects -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add particle effect on like click
    document.addEventListener('click', function(e) {
        const likeBtn = e.target.closest('.comment-like-btn');
        if (likeBtn) {
            createParticles(likeBtn);
        }
    });
    
    function createParticles(button) {
        const rect = button.getBoundingClientRect();
        const heartIcon = button.querySelector('.heart-icon');
        
        // Only create particles for like action (not unlike)
        if (heartIcon && heartIcon.classList.contains('fa-regular')) {
            for (let i = 0; i < 8; i++) {
                const particle = document.createElement('div');
                particle.className = 'heart-particle';
                particle.style.left = (rect.left + rect.width/2) + 'px';
                particle.style.top = (rect.top + rect.height/2) + 'px';
                
                // Random direction and speed
                const angle = Math.random() * Math.PI * 2;
                const speed = 0.5 + Math.random() * 1;
                const distance = 15 + Math.random() * 25;
                
                document.body.appendChild(particle);
                
                // Animate particle
                particle.animate([
                    {
                        opacity: 0.8,
                        transform: `translate(0, 0) scale(1)`
                    },
                    {
                        opacity: 0,
                        transform: `translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px) scale(0)`
                    }
                ], {
                    duration: 800,
                    easing: 'cubic-bezier(0.2, 0, 0.8, 1)'
                });
                
                // Remove particle after animation
                setTimeout(() => particle.remove(), 800);
            }
        }
    }
    
    // Add HTMX afterSwap hook for smooth transitions
    document.body.addEventListener('htmx:afterSwap', function(e) {
        if (e.detail.target && e.detail.target.id.includes('comment_like')) {
            // Find the new like button
            const newBtn = e.detail.target.querySelector('.comment-like-btn');
            if (newBtn) {
                // Trigger CSS animations
                const heartIcon = newBtn.querySelector('.heart-icon');
                const countSpan = newBtn.querySelector('.like-count');
                
                if (heartIcon.classList.contains('fa-solid')) {
                    heartIcon.classList.add('heart-pulse');
                    countSpan.classList.add('like-count-animation');
                    
                    // Remove animation classes after animation completes
                    setTimeout(() => {
                        heartIcon.classList.remove('heart-pulse');
                        countSpan.classList.remove('like-count-animation');
                    }, 500);
                }
            }
        }
    });
});
</script>