
{% load humanize %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KishiFace - Channels</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <style>
    /* ================================================= */
    /* GLOBAL STYLES */
    /* ================================================= */
    :root {
      --primary-color: #666;
      --success-color: #28a745;
      --danger-color: #dc3545;
      --background-light: #f7f7f7;
      --border-color: #e0e0e0;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background-color: var(--background-light);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding-bottom: 60px; /* Space for mobile footer */
    }

    /* HEADER */
    header {
      background: white;
      padding: 15px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    header h1 {
      font-size: 20px;
      color: #333;
    }

    .icon-group {
      display: flex;
      gap: 20px;
    }

    .icon-group a {
      color: #666;
      font-size: 18px;
      position: relative;
      text-decoration: none;
    }

    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: red;
      color: white;
      border-radius: 50%;
      width: 16px;
      height: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: bold;
    }

    /* MAIN CONTENT */
    .main-content {
      padding: 15px;
    }

    /* FORM STYLES */
    .form-section {
      background: white;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .form-section h2 {
      color: #333;
      font-size: 18px;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border-color);
    }

    .form-section label {
      display: block;
      font-weight: 500;
      color: #333;
      margin-top: 15px;
      margin-bottom: 5px;
      font-size: 14px;
    }

    .form-section input[type="text"],
    .form-section textarea,
    .form-section input[type="file"] {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      font-size: 14px;
      background: white;
      transition: border-color 0.2s;
    }

    .form-section input[type="text"]:focus,
    .form-section textarea:focus {
      outline: none;
      border-color: var(--primary-color);
    }

    .form-section textarea {
      min-height: 100px;
      resize: vertical;
    }

    .form-section button[type="submit"] {
      background: var(--primary-color);
      color: white;
      padding: 12px 30px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 600;
      margin-top: 20px;
      width: 100%;
      transition: background-color 0.2s;
    }

    .form-section button[type="submit"]:hover {
      background: #555;
    }

    /* CHANNELS LIST */
    .channels-list {
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .channels-header {
      padding: 15px;
      border-bottom: 1px solid var(--border-color);
    }

    .channels-header h2 {
      color: #333;
      font-size: 18px;
      margin: 0;
    }

    .channel-item {
      display: flex;
      align-items: center;
      padding: 12px 15px;
      border-bottom: 1px solid #f5f5f5;
      transition: background-color 0.2s;
    }

    .channel-item:last-child {
      border-bottom: none;
    }

    .channel-item:hover {
      background-color: #f9f9f9;
    }

    .channel-icon {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      overflow: hidden;
      margin-right: 12px;
      flex-shrink: 0;
    }

    .channel-icon img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .channel-info {
      flex: 1;
      min-width: 0;
    }

    .channel-name {
      display: block;
      color: #333;
      font-weight: 600;
      font-size: 15px;
      text-decoration: none;
      margin-bottom: 3px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .channel-name:hover {
      color: var(--primary-color);
    }

    .channel-details {
      font-size: 12px;
      color: #888;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .channel-actions {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 5px;
      margin-left: 10px;
    }

    .follow-btn {
      padding: 6px 14px;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      min-width: 70px;
      transition: all 0.2s;
    }

    .follow-btn:not(.unfollow) {
      background: var(--primary-color);
      color: white;
    }

    .follow-btn.unfollow {
      background: #e0e0e0;
      color: #333;
    }

    .unread-badge {
      background: red;
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: bold;
      margin-top: 2px;
    }

    .empty-state {
      padding: 40px 20px;
      text-align: center;
      color: #888;
    }

    .empty-state i {
      font-size: 40px;
      margin-bottom: 10px;
      opacity: 0.5;
    }

    .empty-state h5 {
      font-size: 16px;
      font-weight: 500;
      margin-bottom: 5px;
    }

    /* MOBILE FOOTER */
    .mobile-footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      border-top: 1px solid var(--border-color);
      display: flex;
      justify-content: space-around;
      padding: 8px 0;
      z-index: 1000;
    }

    .footer-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-decoration: none;
      color: #666;
      font-size: 10px;
      gap: 4px;
    }

    .footer-item.active {
      color: var(--primary-color);
    }

    .footer-icon {
      font-size: 18px;
      position: relative;
    }

    .footer-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: red;
      color: white;
      border-radius: 50%;
      width: 16px;
      height: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 9px;
      font-weight: bold;
    }

    /* MEMBER SUGGESTIONS */
    .member-suggestions {
      background: white;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .member-suggestions h4 {
      color: #333;
      font-size: 16px;
      margin-bottom: 12px;
    }

    .member-list-horizontal {
      display: flex;
      overflow-x: auto;
      gap: 15px;
      padding-bottom: 5px;
      -webkit-overflow-scrolling: touch;
    }

    .member-list-horizontal::-webkit-scrollbar {
      display: none;
    }

    .member-item {
      flex: 0 0 auto;
      text-align: center;
      width: 70px;
    }

    .member-pic-wrapper {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      overflow: hidden;
      margin: 0 auto 5px;
      border: 2px solid #f0f0f0;
    }

    .member-pic {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .member-username {
      display: block;
      font-size: 11px;
      color: #333;
      text-decoration: none;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
  </style>
</head>
<body>

{% include 'header.html' %}
<main class="main-content">
    <!-- Member Suggestions -->
    <div class="member-suggestions">
        <h4>Faces You May Know</h4>
        <div class="member-list-horizontal">
            {% for member in members %}
                {% if request.user != member %}
                    <div class="member-item">
                        <a href="{% url 'profile' member.username %}" style="text-decoration: none;">
                            <div class="member-pic-wrapper">
                                <img src="{{member.profile.picture.url}}" 
                                     alt="{{member.username}}" 
                                     class="member-pic">
                            </div>
                            <span class="member-username">
                                {% if member.profile.full_name %} 
                                    {{ member.profile.full_name }} 
                                {% else %}
                                    {{ member.username }}
                                {% endif %}
                            </span>
                        </a>
                    </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>

    <!-- Create Channel Form -->
    <div class="form-section">
        <h2>Create New Channel</h2>
        <form action="{% url 'channel_create' %}" method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <label for="name">Channel Name:</label>
            <input type="text" name="name" id="name" placeholder="Enter a unique Channel Name" required>
            
            <label for="about">About (Channel Description):</label>
            <textarea name="about" id="about" placeholder="Tell us about your Channel and what content you will share" required></textarea>
            
            <label for="icon">Channel Icon (Image File):</label>
            <input type="file" name="icon" id="icon" accept="image/*" required>
            
            <button type="submit">Create Channel</button>
        </form>
    </div>

    <!-- Available Channels -->
    <div class="channels-list">
        <div class="channels-header">
            <h2>Available Channels</h2>
        </div>
        
        {% if channels_with_unread %}
            {% for channel_data in channels_with_unread %}
                <div class="channel-item">
                    <div class="channel-icon">
                        <img src="{{ channel_data.channel.image.url }}" alt="{{ channel_data.channel.channel_name }} Icon">
                    </div>
                    
                    <div class="channel-info">
                        <a href="{% url 'channel' channel_data.channel.channel_id %}" class="channel-name">
                            {{ channel_data.channel.channel_name }}
                        </a>
                        <div class="channel-details">
                            {{ channel_data.channel.subscriber.count|intword }} subscribers â€¢ {{ channel_data.channel.about|truncatechars:40 }}
                        </div>
                    </div>
                    
                    <div class="channel-actions">
                        <a href="{% url 'follow_channel' channel_data.channel.channel_id %}">
                            <button type="button" class="follow-btn {% if request.user in channel_data.channel.subscriber.all %}unfollow{% endif %}">
                                {% if request.user in channel_data.channel.subscriber.all %} 
                                    Unfollow 
                                {% else %} 
                                    Follow 
                                {% endif %}
                            </button>
                        </a>
                        {% if channel_data.unread_count > 0 %}
                            <span class="unread-badge">{{ channel_data.unread_count }}</span>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <i class="fas fa-hashtag"></i>
                <h5>No channels yet</h5>
                <p>Be the first to create a channel!</p>
            </div>
        {% endif %}
    </div>
</main>

<!-- Mobile Footer -->
<nav class="mobile-footer">
    <a href="{% url 'home' %}" class="footer-item">
        <i class="fas fa-home footer-icon"></i>
        <span>Home</span>
    </a>
    <a href="{% url 'channel_create' %}" class="footer-item active">
        <i class="fas fa-hashtag footer-icon">
            {% if total_unread > 0 %}
                <span class="footer-badge">{{ total_unread }}</span>
            {% endif %}
        </i>
        <span>Channels</span>
    </a>
    <a href="{% url 'post' %}" class="footer-item">
        <i class="fas fa-plus-square footer-icon"></i>
        <span>Post</span>
    </a>
    <a href="{% url 'notification_list' %}" class="footer-item">
        <i class="fas fa-bell footer-icon">
            {% if notifications.count > 0 %}
                <span class="footer-badge">{{ notifications.count }}</span>
            {% endif %}
        </i>
        <span>Alerts</span>
    </a>
    <a href="{% url 'profile' request.user.username %}" class="footer-item">
        <i class="fas fa-user footer-icon"></i>
        <span>Profile</span>
    </a>
</nav>


</body>
</html>
