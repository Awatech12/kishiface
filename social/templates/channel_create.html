{% load humanize %}
{% load static %}
{% load time %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KishiFace - Channels</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <style>
    /* ================================================= */
    /* SMOOTH CLEAN DESIGN SYSTEM */
    /* ================================================= */
    :root {
      --kf-bg: #f8f9fa;
      --kf-white: #ffffff;
      --kf-text: #1a1a1a;
      --kf-text-light: #666666;
      --kf-primary: #0095f6;
      --kf-primary-light: #e8f4fe;
      --kf-success: #17bf63;
      --kf-danger: #ff3040;
      --kf-border-light: #f0f0f0;
      --kf-border: #dbdbdb;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    html {
      scroll-behavior: smooth;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: var(--kf-bg);
      color: var(--kf-text);
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow-x: hidden;
    }
    
    /* Main content area */
    .main-content { 
      padding: 16px;
      max-width: 600px;
      margin: 0 auto;
      padding-top: 60px;
      width: 100%;
      padding-bottom: 80px; /* Added padding for floating button */
    }
    
    /* CREATE SECTION - Smooth clean design */
    .create-section {
      background: var(--kf-white);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 16px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    
    .create-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--kf-primary), var(--kf-success));
      border-radius: 16px 16px 0 0;
    }
    
    .create-section h2 {
      font-size: 20px;
      font-weight: 600;
      color: var(--kf-text);
      margin-bottom: 20px;
      text-align: center;
      letter-spacing: -0.2px;
    }
    
    .create-channel-btn {
      background: var(--kf-primary);
      color: var(--kf-white);
      padding: 14px 32px;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      font-size: 16px;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      transition: all 0.2s ease;
      position: relative;
      overflow: hidden;
    }
    
    .create-channel-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s ease;
    }
    
    .create-channel-btn:hover::before {
      left: 100%;
    }
    
    .create-channel-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 149, 246, 0.2);
    }
    
    .create-channel-btn:active {
      transform: translateY(0);
    }
    
    /* FLOATING CREATE BUTTON */
    .floating-create-btn {
      position: fixed;
      bottom: 24px;
      right: 24px;
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, var(--kf-primary), #4cb5f9);
      color: var(--kf-white);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      cursor: pointer;
      z-index: 1000;
      box-shadow: 0 4px 20px rgba(0, 149, 246, 0.3);
      border: none;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .floating-create-btn:hover {
      transform: translateY(-4px) scale(1.05);
      box-shadow: 0 8px 25px rgba(0, 149, 246, 0.4);
    }
    
    .floating-create-btn:active {
      transform: translateY(-2px) scale(1.02);
    }
    
    .floating-create-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border-radius: 50%;
      background: inherit;
      animation: pulse 2s infinite;
      z-index: -1;
    }
    
    @keyframes pulse {
      0% {
        transform: scale(1);
        opacity: 0.8;
      }
      50% {
        transform: scale(1.1);
        opacity: 0.4;
      }
      100% {
        transform: scale(1);
        opacity: 0.8;
      }
    }
    
    /* ===== UPDATED MODAL DESIGN (SIMILAR TO REPOST MODAL) ===== */
    .kf-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s, visibility 0.3s;
    }
    
    .kf-modal.show {
      opacity: 1;
      visibility: visible;
    }
    
    .kf-modal-content {
      background: var(--kf-white);
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      overflow: hidden;
      animation: kfSlideIn 0.3s ease;
    }
    
    @keyframes kfSlideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .kf-modal-header {
      padding: 16px;
      border-bottom: 1px solid var(--kf-border);
      text-align: center;
      font-weight: 600;
      font-size: 18px;
    }
    
    .kf-modal-close {
      position: absolute;
      right: 16px;
      top: 16px;
      background: none;
      border: none;
      color: var(--kf-text-light);
      font-size: 24px;
      cursor: pointer;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.2s ease;
      z-index: 10;
    }
    
    .kf-modal-close:hover {
      background-color: var(--kf-bg);
      color: var(--kf-text);
    }
    
    .kf-modal-body {
      padding: 16px;
    }
    
    .kf-form-group {
      margin-bottom: 16px;
    }
    
    .kf-form-group label {
      display: block;
      font-weight: 500;
      font-size: 14px;
      color: var(--kf-text);
      margin-bottom: 8px;
    }
    
    .kf-form-control {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--kf-border);
      border-radius: 8px;
      font-size: 14px;
      font-family: inherit;
      background: var(--kf-white);
      transition: all 0.2s ease;
      color: var(--kf-text);
    }
    
    .kf-form-control:focus {
      outline: none;
      border-color: var(--kf-primary);
    }
    
    .kf-form-control::placeholder {
      color: #999;
      opacity: 0.7;
    }
    
    .kf-form-control[type="file"] {
      padding: 10px;
      cursor: pointer;
      position: relative;
      font-size: 14px;
    }
    
    .kf-form-control[type="file"]::-webkit-file-upload-button {
      background: var(--kf-primary);
      border: none;
      border-radius: 6px;
      padding: 8px 12px;
      cursor: pointer;
      font-family: inherit;
      font-size: 13px;
      font-weight: 500;
      color: white;
      margin-right: 12px;
      transition: all 0.2s ease;
    }
    
    .kf-form-control[type="file"]::-webkit-file-upload-button:hover {
      opacity: 0.9;
    }
    
    .kf-modal-footer {
      padding: 16px;
      border-top: 1px solid var(--kf-border);
      display: flex;
      gap: 12px;
    }
    
    .kf-btn-primary {
      flex: 1;
      padding: 10px;
      background: var(--kf-primary);
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      font-size: 14px;
      transition: all 0.2s ease;
    }
    
    .kf-btn-primary:hover {
      opacity: 0.9;
    }
    
    .kf-btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .kf-btn-secondary {
      flex: 1;
      padding: 10px;
      background: transparent;
      color: var(--kf-text);
      border: 1px solid var(--kf-border);
      border-radius: 6px;
      font-weight: 500;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s ease;
    }
    
    .kf-btn-secondary:hover {
      background-color: var(--kf-bg);
    }
    
    /* Character count styling */
    .kf-char-count {
      font-size: 12px;
      color: var(--kf-text-light);
      text-align: right;
      margin-top: 4px;
    }
    
    /* File input info */
    .kf-file-info {
      font-size: 13px;
      color: var(--kf-text-light);
      margin-top: 6px;
    }
    
    /* CHANNELS LIST STYLE - Clean smooth design */
    .channels-list {
      background: var(--kf-white);
      border-radius: 16px;
      overflow: hidden;
      margin-bottom: 16px;
      position: relative;
    }
    
    .channels-list::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #ff6b6b, #ffd93d, #6bcf7f, #4d96ff);
      border-radius: 16px 16px 0 0;
    }
    
    .channels-header { 
      padding: 20px 20px 16px; 
    }
    
    .channels-header h2 { 
      font-size: 18px; 
      font-weight: 700;
      color: var(--kf-text);
      letter-spacing: -0.3px;
    }
    
    .channel-item {
      display: flex; 
      align-items: center; 
      padding: 16px 20px;
      position: relative;
      transition: all 0.2s ease;
      cursor: pointer;
    }
    
    .channel-item::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 20px;
      right: 20px;
      height: 1px;
      background: var(--kf-border-light);
    }
    
    .channel-item:last-child::after {
      display: none;
    }
    
    .channel-item:hover {
      background-color: var(--kf-primary-light);
    }
    
    .channel-item:active {
      transform: scale(0.995);
    }
    
    .channel-icon { 
      width: 56px; 
      height: 56px; 
      border-radius: 16px; 
      margin-right: 16px; 
      overflow: hidden;
      flex-shrink: 0;
      background: linear-gradient(135deg, #667eea, #764ba2);
      position: relative;
    }
    
    .channel-icon img { 
      width: 100%; 
      height: 100%; 
      object-fit: cover; 
      transition: transform 0.3s ease;
    }
    
    .channel-item:hover .channel-icon img {
      transform: scale(1.05);
    }
    
    .channel-info { 
      flex: 1; 
      min-width: 0;
      overflow: hidden;
    }
    
    .channel-top-row { 
      display: flex; 
      justify-content: space-between; 
      align-items: flex-start;
      margin-bottom: 4px;
      gap: 12px;
    }
    
    .channel-name { 
      font-weight: 600; 
      color: var(--kf-text); 
      text-decoration: none; 
      font-size: 16px;
      letter-spacing: -0.2px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      transition: color 0.2s ease;
    }
    
    .channel-name:hover {
      color: var(--kf-primary);
    }
    
    .channel-time { 
      font-size: 12px; 
      color: var(--kf-text-light); 
      flex-shrink: 0;
      font-weight: 500;
    }
    
    .channel-details { 
      font-size: 14px; 
      color: var(--kf-text-light);
      line-height: 1.4;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }
    
    .unread-badge {
      background: linear-gradient(135deg, var(--kf-danger), #ff6b6b);
      color: white; 
      border-radius: 10px;
      min-width: 24px; 
      height: 24px; 
      display: flex; 
      align-items: center;
      justify-content: center; 
      font-size: 12px; 
      font-weight: 700;
      flex-shrink: 0;
      padding: 0 8px;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    .follow-btn {
      background: linear-gradient(135deg, var(--kf-primary), #4cb5f9);
      color: white; 
      border: none;
      padding: 10px 20px; 
      border-radius: 12px; 
      font-size: 14px; 
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      letter-spacing: -0.1px;
      flex-shrink: 0;
    }
    
    .follow-btn:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }
    
    .follow-btn:active {
      transform: translateY(0);
    }
    
    .follow-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    
    .channel-actions {
      margin-left: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    /* Empty state - Clean design */
    .empty-state {
      padding: 48px 24px;
      text-align: center;
      color: var(--kf-text-light);
      font-size: 16px;
    }
    
    .empty-state i {
      font-size: 48px;
      margin-bottom: 16px;
      color: var(--kf-border-light);
      display: block;
      opacity: 0.7;
    }
    
    .empty-state .subtext {
      font-size: 14px;
      margin-top: 8px;
      color: #999;
    }
    
    /* Loading spinner */
    .kf-spinner {
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 0.8s linear infinite;
      display: inline-block;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Toast notification - Smooth design */
    .kf-toast {
      position: fixed;
      top: 24px;
      right: 24px;
      background: var(--kf-primary);
      color: white;
      padding: 12px 20px;
      border-radius: 6px;
      font-size: 14px;
      z-index: 9999;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      animation: kfSlideIn 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .kf-toast.error {
      background: var(--kf-danger);
    }
    
    .kf-toast.success {
      background: var(--kf-success);
    }
    
    @keyframes kfSlideOut {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(100%);
        opacity: 0;
      }
    }
    
    /* RESPONSIVE DESIGN - Prevent horizontal scroll */
    @media (max-width: 768px) {
      .main-content {
        padding: 12px;
        padding-top: 56px;
        max-width: 100%;
        padding-bottom: 72px; /* Adjusted for floating button */
      }
      
      .create-section {
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 12px;
      }
      
      .create-section h2 {
        font-size: 18px;
        margin-bottom: 16px;
      }
      
      .create-channel-btn {
        padding: 14px 24px;
        font-size: 15px;
        width: 100%;
        justify-content: center;
      }
      
      /* Floating button responsive */
      .floating-create-btn {
        bottom: 20px;
        right: 20px;
        width: 56px;
        height: 56px;
        font-size: 22px;
      }
      
      /* Updated modal responsive */
      .kf-modal-content {
        width: 95%;
        max-width: 400px;
      }
      
      .kf-modal-header {
        padding: 14px;
        font-size: 16px;
      }
      
      .kf-modal-close {
        right: 14px;
        top: 14px;
        width: 36px;
        height: 36px;
        font-size: 22px;
      }
      
      .kf-modal-body {
        padding: 14px;
      }
      
      .kf-form-group {
        margin-bottom: 14px;
      }
      
      .kf-form-control {
        padding: 10px;
        font-size: 14px;
      }
      
      .kf-modal-footer {
        padding: 14px;
        gap: 10px;
      }
      
      .kf-btn-primary,
      .kf-btn-secondary {
        padding: 10px;
        font-size: 14px;
      }
      
      .channels-list {
        border-radius: 12px;
        margin-bottom: 12px;
      }
      
      .channels-header {
        padding: 16px 16px 12px;
      }
      
      .channels-header h2 {
        font-size: 16px;
      }
      
      .channel-item {
        padding: 12px 16px;
      }
      
      .channel-item::after {
        left: 16px;
        right: 16px;
      }
      
      .channel-icon {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        margin-right: 12px;
      }
      
      .channel-name {
        font-size: 15px;
      }
      
      .channel-details {
        font-size: 13px;
        -webkit-line-clamp: 2;
      }
      
      .follow-btn {
        padding: 8px 16px;
        font-size: 13px;
      }
      
      .empty-state {
        padding: 40px 20px;
      }
      
      .empty-state i {
        font-size: 40px;
      }
    }
    
    @media (max-width: 480px) {
      .main-content {
        padding: 8px;
        padding-top: 52px;
        padding-bottom: 68px; /* Adjusted for floating button */
      }
      
      .create-section {
        border-radius: 10px;
        padding: 14px;
      }
      
      .create-section h2 {
        font-size: 16px;
      }
      
      /* Floating button mobile */
      .floating-create-btn {
        bottom: 16px;
        right: 16px;
        width: 52px;
        height: 52px;
        font-size: 20px;
      }
      
      /* Modal full screen on very small devices */
      .kf-modal-content {
        width: 100%;
        height: 100%;
        max-width: none;
        border-radius: 0;
        display: flex;
        flex-direction: column;
      }
      
      .kf-modal-body {
        flex: 1;
        overflow-y: auto;
      }
      
      .kf-modal-footer {
        position: sticky;
        bottom: 0;
        background: var(--kf-white);
      }
      
      .channel-item {
        flex-wrap: wrap;
      }
      
      .channel-top-row {
        flex-wrap: wrap;
      }
      
      .channel-actions {
        margin-left: 0;
        margin-top: 12px;
        width: 100%;
      }
      
      .follow-btn {
        width: 100%;
        justify-content: center;
      }
      
      .channel-name,
      .channel-time {
        width: 100%;
      }
      
      .channel-time {
        order: 3;
        margin-top: 4px;
      }
    }
    
    @media (max-width: 360px) {
      .channel-icon {
        width: 44px;
        height: 44px;
      }
      
      .create-channel-btn,
      .kf-btn-primary,
      .kf-btn-secondary {
        padding: 10px;
        font-size: 14px;
      }
      
      .floating-create-btn {
        bottom: 12px;
        right: 12px;
        width: 48px;
        height: 48px;
      }
      
      .kf-form-control {
        padding: 8px;
        font-size: 13px;
      }
      
      .kf-form-control[type="file"] {
        padding: 8px;
        font-size: 13px;
      }
      
      .kf-form-control[type="file"]::-webkit-file-upload-button {
        padding: 6px 10px;
        font-size: 12px;
      }
    }
    
    /* Ensure no horizontal scroll on any screen */
    body, html {
      max-width: 100%;
      overflow-x: hidden;
    }
    
    img, video, iframe {
      max-width: 100%;
      height: auto;
    }
    
    /* Smooth transitions */
    * {
      transition: background-color 0.2s ease, color 0.2s ease;
    }
    
    /* Focus styles for accessibility */
    :focus {
      outline: 2px solid var(--kf-primary);
      outline-offset: 2px;
    }
    
    :focus:not(:focus-visible) {
      outline: none;
    }
    
    /* Loading states */
    .loading {
      opacity: 0.7;
      pointer-events: none;
    }
    
    /* Fade in animation for content */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .create-section,
    .channels-list {
      animation: fadeIn 0.4s ease;
    }
  </style>
</head>
<body>

{% include 'header.html' %}

<main class="main-content">
   
    <div class="create-section">
        <h2>Channels</h2>
        <!-- Create button removed from here -->
    </div>

    <!-- Floating Create Button -->
    <button class="floating-create-btn" onclick="openCreateChannelModal()">
        <i class="fas fa-plus"></i>
    </button>

    <!-- Create Channel Modal - UPDATED DESIGN -->
    <div class="kf-modal" id="createChannelModal">
        <div class="kf-modal-content">
            <div class="kf-modal-header">
                Create New Channel
                <button class="kf-modal-close" onclick="closeCreateChannelModal()">&times;</button>
            </div>
            <form id="channelCreateForm" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="kf-modal-body">
                    <div class="kf-form-group">
                        <label for="channelName">Channel Name</label>
                        <input type="text" 
                               id="channelName" 
                               name="name" 
                               class="kf-form-control" 
                               placeholder="Enter channel name"
                               required
                               maxlength="100">
                    </div>
                    
                    <div class="kf-form-group">
                        <label for="channelDescription">Description</label>
                        <textarea 
                            id="channelDescription" 
                            name="about" 
                            class="kf-form-control" 
                            placeholder="What is this channel about?"
                            required
                            rows="4"
                            maxlength="500"></textarea>
                        <div class="kf-char-count">
                            <span id="charCount">0</span>/500
                        </div>
                    </div>
                    
                    <div class="kf-form-group">
                        <label for="channelIcon">Channel Icon</label>
                        <input type="file" 
                               id="channelIcon" 
                               name="icon" 
                               class="kf-form-control" 
                               accept="image/*"
                               required>
                        <div class="kf-file-info">
                            Recommended: Square image, 500Ã—500 pixels or larger
                        </div>
                    </div>
                </div>
                <div class="kf-modal-footer">
                    <button type="button" class="kf-btn-secondary" onclick="closeCreateChannelModal()">Cancel</button>
                    <button type="submit" class="kf-btn-primary" id="createChannelBtn">
                        <i class="fas fa-plus"></i> Create Channel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="channels-list">
        <div class="channels-header"><h2>Following</h2></div>
        {% if followed_list %}
            {% for data in followed_list %}
            <div class="channel-item">
                <div class="channel-icon">
                    <img src="{{ data.channel.image.url }}" alt="{{ data.channel.channel_name }}" loading="lazy">
                </div>
                <div class="channel-info">
                    <div class="channel-top-row">
                        <a href="{% url 'channel' data.channel.channel_id %}" class="channel-name">
                            {{ data.channel.channel_name }}
                        </a>
                        <span class="channel-time">
                            {% if data.last_time %}{{ data.last_time|insta_timesince }}{% endif %}
                        </span>
                    </div>
                    <div class="channel-details" id="last-msg-{{ data.channel.channel_id }}">
                        {{ data.last_message|truncatechars:60 }}
                    </div>
                </div>
                <div class="channel-actions">
                    {% if data.unread_count > 0 %}
                        <span class="unread-badge">{{ data.unread_count }}</span>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <i class="far fa-comments"></i>
                <div>Channels you follow will appear here</div>
                <div class="subtext">Start following channels to see their updates</div>
            </div>
        {% endif %}
    </div>

    <div class="channels-list">
        <div class="channels-header"><h2>Find Channels</h2></div>
        {% if unfollowed_channels %}
            {% for channel in unfollowed_channels %}
            <div class="channel-item">
                <div class="channel-icon">
                    <img src="{{ channel.image.url }}" alt="{{ channel.channel_name }}" loading="lazy">
                </div>
                <div class="channel-info">
                    <div class="channel-top-row">
                        <a href="{% url 'channel' channel.channel_id %}" class="channel-name">
                            {{ channel.channel_name }}
                        </a>
                    </div>
                    <div class="channel-details">{{ channel.about|truncatechars:60 }}</div>
                </div>
                <div class="channel-actions">
                    <button class="follow-btn" onclick="followChannel('{{ channel.channel_id }}', this)">
                        Follow
                    </button>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <i class="fas fa-search"></i>
                <div>No new channels to discover</div>
                <div class="subtext">Check back later for new channels</div>
            </div>
        {% endif %}
    </div>
</main>

<script>
    // Modal functions
    function openCreateChannelModal() {
        const modal = document.getElementById('createChannelModal');
        modal.classList.add('show');
        document.body.style.overflow = 'hidden'; // Prevent background scroll
        document.getElementById('channelName').focus();
    }

    function closeCreateChannelModal() {
        const modal = document.getElementById('createChannelModal');
        modal.classList.remove('show');
        document.body.style.overflow = ''; // Restore scroll
        
        // Reset form after animation
        setTimeout(() => {
            document.getElementById('channelCreateForm').reset();
            document.getElementById('charCount').textContent = '0';
        }, 300);
    }

    // Close modal when clicking outside
    document.getElementById('createChannelModal').addEventListener('click', function(event) {
        if (event.target === this) {
            closeCreateChannelModal();
        }
    });

    // Close modal with Escape key
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape' && document.getElementById('createChannelModal').classList.contains('show')) {
            closeCreateChannelModal();
        }
    });

    // Character counter for description
    const descriptionTextarea = document.getElementById('channelDescription');
    const charCountSpan = document.getElementById('charCount');
    
    if (descriptionTextarea) {
        descriptionTextarea.addEventListener('input', function() {
            charCountSpan.textContent = this.value.length;
        });
    }

    // Form submission handling
    document.getElementById('channelCreateForm').addEventListener('submit', async function(event) {
        event.preventDefault();
        
        const form = event.target;
        const submitBtn = document.getElementById('createChannelBtn');
        const originalBtnContent = submitBtn.innerHTML;
        
        // Show loading state
        submitBtn.innerHTML = '<span class="kf-spinner"></span> Creating...';
        submitBtn.disabled = true;
        
        // Create FormData object
        const formData = new FormData(form);
        
        try {
            const response = await fetch("{% url 'channel_create' %}", {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                }
            });
            
            if (response.ok) {
                // Success - show toast and reload
                showToast('Channel created successfully!', 'success');
                closeCreateChannelModal();
                setTimeout(() => {
                    window.location.reload();
                }, 1500);
            } else {
                // Handle errors
                const errorText = await response.text();
                console.error('Form submission error:', errorText);
                showToast('Error creating channel. Please try again.', 'error');
                submitBtn.innerHTML = originalBtnContent;
                submitBtn.disabled = false;
            }
        } catch (error) {
            console.error('Network error:', error);
            showToast('Network error. Please check your connection.', 'error');
            submitBtn.innerHTML = originalBtnContent;
            submitBtn.disabled = false;
        }
    });

    // Follow channel function
    async function followChannel(channelId, button) {
        const originalText = button.innerHTML;
        
        // Show loading state
        button.innerHTML = '<span class="kf-spinner"></span>';
        button.disabled = true;
        
        try {
            const response = await fetch(`/follow_channel/${channelId}/`, {
                method: 'GET',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'Content-Type': 'application/json',
                }
            });
            
            if (response.ok) {
                const data = await response.json();
                if (data.success) {
                    showToast('Channel followed successfully!', 'success');
                    // Remove channel from "Find Channels" list
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);
                } else {
                    showToast(data.error || 'Error following channel', 'error');
                    button.innerHTML = originalText;
                    button.disabled = false;
                }
            } else {
                showToast('Server error. Please try again.', 'error');
                button.innerHTML = originalText;
                button.disabled = false;
            }
        } catch (error) {
            console.error('Network error:', error);
            showToast('Network error. Please check your connection.', 'error');
            button.innerHTML = originalText;
            button.disabled = false;
        }
    }

    // Toast notification function - UPDATED TO MATCH HOME.HTML
    function showToast(message, type = 'success') {
        const toast = document.createElement('div');
        toast.className = `kf-toast ${type}`;
        toast.innerHTML = `
            <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
            <span>${message}</span>
        `;
        
        document.body.appendChild(toast);
        
        // Remove after 3 seconds
        setTimeout(() => {
            toast.style.animation = 'kfSlideOut 0.3s ease';
            setTimeout(() => {
                if (toast.parentNode) {
                    document.body.removeChild(toast);
                }
            }, 300);
        }, 3000);
    }

    // Get CSRF token (if needed for other AJAX calls)
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    // Initialize character count on page load
    if (descriptionTextarea) {
        charCountSpan.textContent = descriptionTextarea.value.length;
    }

    // Prevent horizontal scroll
    window.addEventListener('resize', function() {
        document.body.style.overflowX = 'hidden';
    });

    // Initialize on load
    document.addEventListener('DOMContentLoaded', function() {
        document.body.style.overflowX = 'hidden';
        
        // Add smooth hover effects
        const channelItems = document.querySelectorAll('.channel-item');
        channelItems.forEach(item => {
            item.addEventListener('touchstart', function() {
                this.classList.add('active');
            });
            
            item.addEventListener('touchend', function() {
                setTimeout(() => {
                    this.classList.remove('active');
                }, 150);
            });
        });
    });
</script>

</body>
</html>


