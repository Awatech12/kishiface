{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post</title>
    <link rel="shortcut icon" href="{% static 'images/logo.jpg' %}" type="image/x-icon">
    <style>
    /*
     * COMBINED STYLE: LinkedIn Boxed Card with Instagram Carousel Functionality
     */
    :root {
      --main-bg: #f0f2f5;
      --white: #ffffff;
      --border-color: #e0e0e0;
      --primary-color: #0077b5;
      --text-dark: #1f1f1f;
      --text-muted: #6a6a6a;
      --font-stack: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }

    body {
      font-family: var(--font-stack);
      background-color: var(--main-bg);
      margin: 0;
      padding-bottom: 49px;
      color: var(--text-dark);
    }
    
    /* ===== Global Utility & Card Style (Boxed) ===== */
    .container { max-width: 600px; margin: 0 auto; padding: 0; }
    .card {
      background: var(--white);
      margin-bottom: 15px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    .btn { padding: 6px 12px; border-radius: 4px; cursor: pointer; border: none; font-weight: 600; font-size: 14px; }
    .btn-blue { background: var(--primary-color); color: var(--white); }
    .btn-blue:hover { background: #006093; }
    .text-center { text-align: center; }

    /* Post Creation Form (Re-used) */
    .post-form { padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; margin-bottom: 15px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
    textarea { width:90%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; resize: none; margin-bottom: 10px; font-size: 14px; }
    .form-actions { display:flex; justify-content:space-between; align-items:center; }
    .file-label {
      color: var(--primary-color); cursor: pointer; font-size: 14px; font-weight: 600; display: flex; align-items: center; gap: 6px;
      padding: 6px 8px; border: 1px solid transparent; border-radius: 4px; transition: background-color 0.2s;
    }
    .file-label:hover { background-color: #f0f8ff; border-color: #b0d8f0; }
    input[type=file] { display: none; }

    /* for audio record */
      #icon{
  margin:0 10px;
}

audio{
  width: 100%;
  outline: none;
  background-color: #eef2f7;
}
audio::-webkit-media-controls-pannel{
  background-color: #eef2f7;
}

button{
  font-size: 24px;
  border: none;
  cursor: pointer;
  margin: 8px;
  background-color: #ffffff;
  transform: color 0.3s ease;
}
button:hover{
  color: #007bff;
}

     .recording{
      position: relative;
      font-size: 20px;
      color: #ff3b30;
      animation: pulse 1s infinite;
    }

    @keyframes pulse{
      0% {
        transform: scale(1);
        opacity: 1;
      }
      50%{
        transform: scale(1.3);
        opacity: 0.5;
      }
      100% {
        transform: scale(1);
        opacity: 1;
      }
    }
</style>
</head>
<body>
    {% include 'header.html' %}
    <main class="container">

  <div class="card post-form" id="myForm">
    <h3 style="margin-bottom:10px; font-size: 16px; font-weight: 600; color: var(--text-dark);">Create New Post</h3>
    <form id="postForm"
    action="{% url 'post' %}" 
    method="post"
    enctype="multipart/form-data"
    >
      {% csrf_token %}
      <textarea name="content" rows="3" placeholder="Write a caption..." ></textarea>
      <div class="form-actions">
        <label for="images" class="file-label">
          <i class="fa-solid fa-camera"></i>
          Add Photo(s)
        </label>
        <label for="video_file">Video</label>
         <button id="startBtn" type="button"><i class="fa-solid fa-microphone"></i></button> <span id="status"></span> <button id="stopBtn" type="button" hidden><i class="fa-solid fa-circle-stop"></i></button>
        <input type="file" name="audio_file" id="audio_file" accept="audio/*" hidden>
        <input type="file" name="video_file" id="video_file" accept="video/*" hidden>
        <input type="file" id="images" name="images" accept="image/*" multiple >
        <select id="moodSelect" style="padding:6px; border:1px solid #ccc; border-radius:4px; margin-bottom:8px;">
    <option value="">Select Mood</option>
    <option value="happy">Happy üòä</option>
    <option value="sad">Sad üò¢</option>
    <option value="excited">Excited ü§©</option>
    <option value="romantic">Romantic ‚ù§Ô∏è</option>
    <option value="motivated">Motivated üí™</option>
    <option value="angry">Angry üò°</option>
</select>

<button type="button" id="aiTextBtn" class="btn btn-blue" style="margin-bottom:10px;">
    Generate AI Text
</button>
        <button type="submit" class="btn btn-blue">Share</button>
      </div>
    </form>
  </div>
  </main>

  <script>
    
  /*** Recording Code */
  let mediaRecord;
  let audioChucks = [];
  const startBtn = document.getElementById('startBtn');
  const stopBtn = document.getElementById('stopBtn');
  const audio_file = document.getElementById('audio_file');
  const status = document.getElementById('status');
  startBtn.addEventListener('click', async function(){
    try{
      const stream = await navigator.mediaDevices.getUserMedia({
      audio:true
    });
    mediaRecord = new MediaRecorder(stream);
    audioChucks = [];
    mediaRecord.ondataavailable = event =>audioChucks.push(event.data);
    mediaRecord.onstop = async () =>{
      const bob = new Blob(audioChucks, {
        type: 'audio/webm'
      });
      const file = new File([bob], 'recorded_audio.webm',{
        type: 'audio/webm'
      });
      const dataTransfer = new DataTransfer();
      dataTransfer.items.add(file);
      audio_file.files = dataTransfer.files;
    };
    mediaRecord.start();
    status.innerHTML = `<i class="fa-solid fa-circle recording"></i>`;
    startBtn.hidden = true;
    stopBtn.hidden = false;
    }catch(err){
      alert('MicroPhone acess denied')
    }

  })

  stopBtn.onclick = () =>{
    mediaRecord.stop();
    status.textContent = 'Recording Stoped';
    startBtn.hidden = false;
    stopBtn.hidden = true;
  }

  /** AI CODE **/
  

document.getElementById("aiTextBtn").onclick = function() {
    let mood = document.getElementById("moodSelect").value;
    if (!mood) {
        alert("Please select a mood");
        return;
    }

    fetch(`/generate_ai_text/?mood=${mood}`)
        .then(res => res.json())
        .then(data => {
            if (data.error) {
                alert(data.error);
                return;
            }

            const textarea = document.querySelector("textarea[name='content']");
            textarea.value = "";

            // Optional: typing animation
            let i = 0;
            function typeWriter() {
                if (i <= data.caption.length) {
                    textarea.value = data.caption.slice(0, i);
                    i++;
                    setTimeout(typeWriter, 30 + Math.random() * 30);
                }
            }
            typeWriter();
        })
        .catch(err => {
            console.error(err);
            alert("Error generating AI text");
        });
};

  </script>
</body>
</html>
{% include 'footer.html' %}